<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>결제하기 - Mrble</title>
    
    <!-- 폰트 로드 (비동기 로드 및 최적화) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;900&family=Poppins:wght@400;500;600;700;800;900&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Common Header CSS -->
    <link rel="stylesheet" href="../css/common-header.css">
    
    <!-- 페이앱 설정 -->
    <script>
        // config.js 파일이 없을 때를 위한 기본 설정
        if (typeof CONFIG === 'undefined') {
            const CONFIG = {
                userid: 'ksbm',
                linkkey: 'QLo9WUgFwaqAYjAiv6z86e1DPJnCCRVaOgT+oqg6zaM=',
                feedbackurl: '',  // 빈 값으로 설정 (에러 70080 방지)
                returnurl: '',  // 동적으로 설정됨
                environment: 'production'
            };
            window.CONFIG = CONFIG;
        }
    </script>
    <script src="../config.js"></script>
    
    <!-- 페이앱 커스텀 결제 모듈 -->
    <script src="../js/payapp-payment.js"></script>
    
    <!-- 페이앱 라이트 SDK -->
    <script src="https://lite.payapp.kr/public/api/payapp-lite.js" defer></script>
    
    <!-- 페이앱 초기화 -->
    <script>
        // PayApp SDK 초기화 상태 추적
        window.payAppReady = false;
        
        // PayApp SDK 초기화 함수
        function initPayApp() {
            if (typeof PayApp !== 'undefined' && typeof CONFIG !== 'undefined') {
                console.log('✅ PayApp 라이트 SDK 로드 완료');
                
                try {
                    // 기본 설정
                    PayApp.setDefault('userid', CONFIG.userid);
                    PayApp.setDefault('shopname', 'Mrble');
                    console.log('✅ PayApp 기본 설정 완료');
                    window.payAppReady = true;
                } catch (error) {
                    console.error('PayApp 초기화 오류:', error);
                }
            } else {
                console.warn('⏳ PayApp SDK 로드 대기 중...');
                // 재시도
                setTimeout(initPayApp, 100);
            }
        }
        
        // 페이지 로드 후 초기화
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initPayApp);
        } else {
            initPayApp();
        }
    </script>
    
    <!-- CSS 최적화: preload 사용 -->
    <link rel="preload" href="../css/variables.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="../css/reset.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="../css/main.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <!-- Auth Manager -->
    <script src="../js/auth.js"></script>

    <noscript>
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/reset.css">
        <link rel="stylesheet" href="../css/main.css">
    </noscript>
    
    <style>
        /* 결제 페이지 전용 스타일 */
        
        /* 헤더 네비게이션 폰트 스타일 - 메인과 동일하게 */
        .nav-logo {
            font-size: 18px;
            white-space: nowrap;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 600;
        }
        
        .nav-link {
            font-size: 14px;
        }
        
        .checkout-page {
            background: rgba(245, 245, 247, 0.5);
            min-height: 100vh;
            padding-top: 100px;
            padding-bottom: var(--spacing-3xl);
        }
        
        .checkout-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: var(--spacing-2xl);
            align-items: start;
        }
        
        /* 진행 단계 표시 */
        .checkout-steps {
            display: flex;
            justify-content: center;
            margin-bottom: var(--spacing-3xl);
            gap: var(--spacing-xl);
        }
        
        .step {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--color-bg-primary);
            border: 2px solid var(--color-text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--color-text-muted);
            transition: var(--transition-default);
        }
        
        .step.active .step-number {
            background: var(--color-primary-main);
            border-color: var(--color-primary-main);
            color: var(--color-text-light);
        }
        
        .step.completed .step-number {
            background: var(--color-primary-main);
            border-color: var(--color-primary-main);
            color: var(--color-text-light);
        }
        
        .step-label {
            font-weight: 500;
            color: var(--color-text-muted);
            transition: var(--transition-default);
        }
        
        .step.active .step-label {
            color: var(--color-text-primary);
        }
        
        .step-arrow {
            color: var(--color-text-muted);
            margin: 0 var(--spacing-md);
        }
        
        /* 메인 폼 영역 */
        .checkout-main {
            background: var(--color-bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-sm);
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
            color: var(--color-text-primary);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--color-primary-main);
        }
        
        /* 폼 스타일 */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .form-row.single {
            grid-template-columns: 1fr;
        }
        
        .form-group {
            margin-bottom: var(--spacing-md);
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: var(--spacing-xs);
            color: var(--color-text-primary);
            font-size: 14px;
        }
        
        .form-label .required {
            color: #ff3b30;
        }
        
        .form-input,
        .form-select {
            width: 100%;
            padding: var(--spacing-sm);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: var(--transition-default);
            background: var(--color-bg-primary);
        }
        
        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--color-primary-main);
            box-shadow: 0 0 0 3px rgba(41, 212, 193, 0.1);
        }
        
        .form-textarea {
            width: 100%;
            min-height: 100px;
            padding: var(--spacing-sm);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: var(--radius-sm);
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
        }
        
        /* 결제 수단 선택 */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }
        
        .payment-method {
            padding: var(--spacing-md);
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-default);
            background: var(--color-bg-primary);
        }
        
        .payment-method:hover {
            border-color: var(--color-primary-main);
            background: rgba(41, 212, 193, 0.05);
        }
        
        .payment-method.selected {
            border-color: var(--color-primary-main);
            background: rgba(41, 212, 193, 0.1);
        }
        
        .payment-icon {
            font-size: 24px;
            margin-bottom: var(--spacing-xs);
        }
        
        .payment-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-primary);
        }
        
        /* 주문 요약 사이드바 */
        .checkout-sidebar {
            position: sticky;
            top: 100px;
        }
        
        .order-summary {
            background: var(--color-bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--color-primary-main);
        }
        
        .summary-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            color: var(--color-text-primary);
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .summary-item:last-of-type {
            border-bottom: none;
        }
        
        .summary-label {
            color: var(--color-text-secondary);
            font-size: 14px;
        }
        
        .summary-value {
            font-weight: 500;
            color: var(--color-text-primary);
            font-size: 14px;
        }
        
        .summary-divider {
            height: 1px;
            background: rgba(0,0,0,0.1);
            margin: var(--spacing-md) 0;
        }
        
        .summary-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--spacing-md);
        }
        
        .total-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text-primary);
        }
        
        .total-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary-main);
            font-family: var(--font-tertiary);
        }
        
        /* 약관 동의 */
        .agreement-section {
            background: rgba(0,0,0,0.02);
            border-radius: var(--radius-sm);
            padding: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }
        
        .checkbox-group {
            margin-bottom: var(--spacing-sm);
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            cursor: pointer;
            font-size: 14px;
            color: var(--color-text-primary);
        }
        
        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .agreement-all {
            font-weight: 600;
            padding-bottom: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        /* 안전 결제 배지 */
        .security-badges {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        
        .security-badge {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: 12px;
            color: var(--color-text-secondary);
        }
        
        .security-icon {
            color: var(--color-primary-main);
        }
        
        /* 패키지 선택 스타일 */
        .package-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }
        
        .package-option {
            background: var(--color-bg-primary);
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: var(--radius-lg);
            padding: calc(var(--spacing-lg) * 1.3) var(--spacing-lg);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-default);
            position: relative;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .package-option:hover {
            border-color: var(--color-primary-main);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .package-option.selected {
            border: 3px solid var(--color-primary-main) !important;
            background: rgba(41, 212, 193, 0.08) !important;
            box-shadow: 0 0 0 4px rgba(41, 212, 193, 0.15) !important;
            transform: scale(1.02);
        }
        
        .package-badge {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            font-family: var(--font-secondary);
        }
        
        .package-people {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-sm);
            font-family: var(--font-tertiary);
        }
        
        .package-price-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-xs);
        }
        
        /* 반응형 */
        @media (max-width: 1024px) {
            .checkout-container {
                grid-template-columns: 1fr;
            }
            
            .checkout-sidebar {
                position: static;
                order: -1;
            }
            
            .payment-methods {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .package-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 767px) {
            .checkout-steps {
                flex-direction: column;
                align-items: center;
            }
            
            .step-arrow {
                display: none;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .payment-methods {
                grid-template-columns: 1fr;
            }
            
            .checkout-main {
                padding: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <!-- Common Header Container -->
    <div id="header-container"></div>
    <script src="../js/common-header.js"></script>

    <!-- AuthManager 로드 (사용자 정보 자동 입력을 위해 필요) -->
    <script src="../js/auth.js"></script>
    
    <div class="checkout-page">
        <div class="container">
            <!-- 진행 단계 -->
            <div class="checkout-steps">
                <div class="step completed">
                    <span class="step-number">✓</span>
                    <span class="step-label">패키지 선택</span>
                </div>
                <span class="step-arrow">→</span>
                <div class="step active">
                    <span class="step-number">2</span>
                    <span class="step-label">정보 입력</span>
                </div>
                <span class="step-arrow">→</span>
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-label">결제 완료</span>
                </div>
            </div>
            
            <div class="checkout-container">
                <!-- 메인 폼 -->
                <div class="checkout-main">
                    <!-- 패키지 선택 -->
                    <section style="margin-bottom: var(--spacing-2xl);">
                        <h2 class="section-title">패키지 선택</h2>
                        <div class="package-options">
                            <!-- 60명 패키지 -->
                            <div class="package-option" data-people="60" data-original="600000" data-price="360000" data-discount="40">
                                <div class="package-badge" style="background: #ff3b30; color: var(--color-text-light);">40% 할인</div>
                                <h3 class="package-people">60명</h3>
                                <div class="package-price-info">
                                    <span class="original-price" style="text-decoration: line-through; color: var(--color-text-muted); font-size: 14px;">600,000원</span>
                                    <span class="discounted-price" style="color: var(--color-primary-main); font-size: 24px; font-weight: 700;">360,000원</span>
                                </div>
                                <p class="per-person" style="font-size: 12px; color: var(--color-text-secondary);">1인당 6,000원</p>
                            </div>
                            
                            <!-- 30명 패키지 -->
                            <div class="package-option" data-people="30" data-original="300000" data-price="240000" data-discount="20">
                                <div class="package-badge" style="background: #ff9500; color: var(--color-text-light);">20% 할인</div>
                                <h3 class="package-people">30명</h3>
                                <div class="package-price-info">
                                    <span class="original-price" style="text-decoration: line-through; color: var(--color-text-muted); font-size: 14px;">300,000원</span>
                                    <span class="discounted-price" style="color: var(--color-primary-main); font-size: 24px; font-weight: 700;">240,000원</span>
                                </div>
                                <p class="per-person" style="font-size: 12px; color: var(--color-text-secondary);">1인당 8,000원</p>
                            </div>
                            
                            <!-- 10명 패키지 -->
                            <div class="package-option" data-people="10" data-original="100000" data-price="100000" data-discount="0">
                                <h3 class="package-people">10명</h3>
                                <div class="package-price-info">
                                    <span class="discounted-price" style="color: var(--color-primary-main); font-size: 24px; font-weight: 700;">100,000원</span>
                                </div>
                                <p class="per-person" style="font-size: 12px; color: var(--color-text-secondary);">1인당 10,000원</p>
                            </div>
                        </div>
                    </section>
                    
                    <!-- 주문자 정보 -->
                    <section>
                        <h2 class="section-title">주문자 정보</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">이름 <span class="required">*</span></label>
                                <input type="text" id="name" class="form-input" placeholder="홍길동" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">연락처 <span class="required">*</span></label>
                                <input type="tel" id="phone" class="form-input" placeholder="010-0000-0000" maxlength="13" required>
                                <small class="form-hint" style="color: #999; font-size: 12px; margin-top: 4px; display: block;">숫자만 입력하세요 (하이픈 자동 추가)</small>
                            </div>
                        </div>
                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label">이메일 <span class="required">*</span></label>
                                <input type="email" id="email" class="form-input" placeholder="example@email.com" required>
                                <small class="form-hint" style="color: #999; font-size: 12px; margin-top: 4px; display: block;">올바른 이메일 주소를 입력해주세요</small>
                            </div>
                        </div>
                        <!-- 매장명과 사업자등록번호 숨김 처리 -->
                        <!--
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">매장명</label>
                                <input type="text" id="company" class="form-input" placeholder="회사명 (선택)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">사업자등록번호</label>
                                <input type="text" id="business-number" class="form-input" placeholder="000-00-00000" maxlength="12">
                                <small class="form-hint" style="color: #999; font-size: 12px; margin-top: 4px; display: block;">세금계산서 발행 시 필요</small>
                            </div>
                        </div>
                        -->
                    </section>
                    
                    <!-- 서비스 정보 -->
                    <section style="margin-top: var(--spacing-2xl);">
                        <h2 class="section-title">서비스 정보</h2>
                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label">매장명 / 회사명 <span class="required">*</span></label>
                                <input type="text" id="store-name" class="form-input" placeholder="예: 강남역 OO식당" required>
                            </div>
                        </div>
                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label">업종 선택 <span class="required">*</span></label>
                                <select id="business-type" class="form-select" required>
                                    <option value="">업종을 선택해주세요</option>
                                    <option value="restaurant">음식점</option>
                                    <option value="cafe">카페</option>
                                    <option value="beauty">뷰티/미용</option>
                                    <option value="fashion">패션</option>
                                    <option value="education">교육</option>
                                    <option value="medical">의료/건강</option>
                                    <option value="realestate">부동산</option>
                                    <option value="other">기타</option>
                                </select>
                            </div>
                        </div>
                        <!-- 홍보할 상품/서비스명, 요청사항 숨김 처리 -->
                        <!--
                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label">홍보할 상품/서비스명 <span class="required">*</span></label>
                                <input type="text" class="form-input" placeholder="예: 강남역 맛집 OO식당" required>
                            </div>
                        </div>
                        <div class="form-row single">
                            <div class="form-group">
                                <label class="form-label">요청사항</label>
                                <textarea class="form-textarea" placeholder="특별히 요청하실 사항을 입력해주세요 (선택)"></textarea>
                            </div>
                        </div>
                        -->
                    </section>
                    
                    <!-- 결제 수단 -->
                    <section style="margin-top: var(--spacing-2xl);">
                        <h2 class="section-title">결제 수단</h2>
                        <div class="payment-methods">
                            <div class="payment-method selected">
                                <div class="payment-icon">💳</div>
                                <div class="payment-name">신용카드</div>
                            </div>
                            <div class="payment-method">
                                <div class="payment-icon">🏦</div>
                                <div class="payment-name">계좌이체</div>
                            </div>
                            <!-- 카카오페이, 네이버페이, 토스페이, 세금계산서 숨김 처리 -->
                            <!--
                            <div class="payment-method">
                                <div class="payment-icon">📱</div>
                                <div class="payment-name">카카오페이</div>
                            </div>
                            <div class="payment-method">
                                <div class="payment-icon">💚</div>
                                <div class="payment-name">네이버페이</div>
                            </div>
                            <div class="payment-method">
                                <div class="payment-icon">🍎</div>
                                <div class="payment-name">토스페이</div>
                            </div>
                            <div class="payment-method">
                                <div class="payment-icon">📄</div>
                                <div class="payment-name">세금계산서</div>
                            </div>
                            -->
                        </div>
                    </section>
                    
                </div>
                
                <!-- 주문 요약 사이드바 -->
                <div class="checkout-sidebar">
                    <div class="order-summary">
                        <h3 class="summary-title">주문 요약</h3>
                        
                        <div id="summary-empty" style="padding: var(--spacing-xl); text-align: center; color: var(--color-text-secondary);">
                            <p>패키지를 선택해주세요</p>
                        </div>
                        
                        <div id="summary-content" style="display: none;">
                            <div class="summary-item">
                                <span class="summary-label">상품명</span>
                                <span class="summary-value">블로그 체험단</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">인원수</span>
                                <span class="summary-value" id="summary-people">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">정상가</span>
                                <span class="summary-value" id="summary-original" style="text-decoration: line-through; color: var(--color-text-muted);">-</span>
                            </div>
                            <div class="summary-item" id="discount-row" style="display: none;">
                                <span class="summary-label" id="discount-label">할인</span>
                                <span class="summary-value" id="summary-discount" style="color: #ff3b30;">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">상품금액</span>
                                <span class="summary-value" id="summary-price" style="font-weight: 600;">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">부가세 (10%)</span>
                                <span class="summary-value" id="summary-vat">-</span>
                            </div>
                            
                            <div class="summary-divider"></div>
                            
                            <div class="summary-total">
                                <span class="total-label">최종 결제금액</span>
                                <span class="total-value" id="summary-total">-</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary btn-large" 
                                style="width: 100%; 
                                       margin-top: var(--spacing-lg); 
                                       background: var(--color-primary-main); 
                                       color: var(--color-bg-primary);
                                       border: none;
                                       border-radius: var(--radius-md);
                                       padding: var(--spacing-md) var(--spacing-lg);
                                       font-size: 18px;
                                       font-weight: 700;
                                       cursor: pointer;
                                       transition: all 0.3s ease;
                                       box-shadow: 0 4px 12px rgba(41, 212, 193, 0.3);"
                                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(41, 212, 193, 0.4)';"
                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(41, 212, 193, 0.3)';"
                                onclick="processPayment()">
                            💳 결제하기
                        </button>
                        
                        <div class="security-badges">
                            <div class="security-badge">
                                <span class="security-icon">🔒</span>
                                <span>SSL 보안결제</span>
                            </div>
                            <div class="security-badge">
                                <span class="security-icon">✓</span>
                                <span>PG사 인증</span>
                            </div>
                        </div>
                        
                        <!-- 약관 동의 -->
                        <div class="agreement-section" style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--color-border);">
                            <div class="checkbox-group agreement-all" style="margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--color-border);">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="agree-all">
                                    <span style="font-weight: 600;">전체 동의</span>
                                </label>
                            </div>
                            <div class="checkbox-group" style="margin-bottom: var(--spacing-xs);">
                                <label class="checkbox-label">
                                    <input type="checkbox" class="agree-item" required>
                                    <span style="font-size: 14px;">(필수) 서비스 이용약관 동의</span>
                                </label>
                            </div>
                            <div class="checkbox-group" style="margin-bottom: var(--spacing-xs);">
                                <label class="checkbox-label">
                                    <input type="checkbox" class="agree-item" required>
                                    <span style="font-size: 14px;">(필수) 개인정보 수집 및 이용 동의</span>
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" class="agree-item">
                                    <span style="font-size: 14px;">(선택) 마케팅 정보 수신 동의</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 심플 푸터 -->
    <footer class="simple-footer">
        <div class="container">
            <div class="footer-wrapper">
                <!-- Customer Service -->
                <div class="footer-customer">
                    <div class="footer-title">미블문의</div>
                    <div class="footer-phone">010-7362-7711</div>
                    <!--<div class="footer-fax">Fax. 02-000-0000</div>"-->
                </div>
                
                <!-- Info -->
                <div class="footer-info">
                    <div class="footer-title">Info.</div>
                    <div class="footer-info-text">상호명 : 미블(Mrble)  |  대표 : 안소연  |  사업자등록번호 : 165-88-02749</div>
                    <div class="footer-info-text">주소 : 서울특별시 광진구 천호대로 571 | 전국 최저가 정직한 체험단 마케팅 플랫폼</div>
                </div>
                
                <!-- Chart Icon -->
                <div class="footer-chart">
                    <div class="chart-bar"></div>
                    <div class="chart-bar"></div>
                    <div class="chart-bar"></div>
                    <div class="chart-bar"></div>
                </div>
            </div>
        </div>
    </footer>
    
    <script>
        // 빠른 초기화를 위해 DOMContentLoaded 이벤트 사용
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initializePage();
            });
        } else {
            // 이미 로드된 경우 즉시 실행
            initializePage();
        }
        
        // 페이앱 설정 확인 (config.js에서 이미 로드됨)
        if (typeof CONFIG === 'undefined') {
            console.warn('config.js 파일이 없습니다. 기본 설정을 사용합니다.');
            window.CONFIG = {
                userid: 'meble_test',
                linkkey: '',
                feedbackurl: 'https://meble.kr/api/payment/callback',
                returnurl: 'https://meble.kr/payment-complete',
                environment: 'development'
            };
        }
        
        // 패키지 선택 기능
        const packageOptions = document.querySelectorAll('.package-option');
        let selectedPackage = null;
        
        console.log('패키지 옵션 개수:', packageOptions.length);
        
        packageOptions.forEach(option => {
            option.addEventListener('click', () => {
                console.log('패키지 클릭됨:', option.dataset.people);
                
                // 모든 옵션에서 selected 클래스 제거
                packageOptions.forEach(opt => opt.classList.remove('selected'));
                
                // 선택한 옵션에 selected 클래스 추가
                option.classList.add('selected');
                
                // 데이터 가져오기
                const people = option.dataset.people;
                const originalPrice = parseInt(option.dataset.original);
                const price = parseInt(option.dataset.price);
                const discount = parseInt(option.dataset.discount);
                
                console.log('패키지 데이터:', { people, originalPrice, price, discount });
                
                // 선택된 패키지 저장
                selectedPackage = {
                    people: people,
                    originalPrice: originalPrice,
                    price: price,
                    discount: discount
                };
                
                // 주문 요약 업데이트
                updateOrderSummary();
            });
        });
        
        function updateOrderSummary() {
            console.log('updateOrderSummary 호출됨:', selectedPackage);
            if (!selectedPackage) return;
            
            // 빈 메시지 숨기고 내용 표시
            document.getElementById('summary-empty').style.display = 'none';
            document.getElementById('summary-content').style.display = 'block';
            
            console.log('주문 요약 업데이트 시작');
            
            // 인원수
            document.getElementById('summary-people').textContent = selectedPackage.people + '명';
            
            // 정상가
            document.getElementById('summary-original').textContent = selectedPackage.originalPrice.toLocaleString() + '원';
            
            // 할인
            if (selectedPackage.discount > 0) {
                document.getElementById('discount-row').style.display = 'flex';
                const discountAmount = selectedPackage.originalPrice - selectedPackage.price;
                document.getElementById('discount-label').textContent = `할인 (${selectedPackage.discount}%)`;
                document.getElementById('summary-discount').textContent = '-' + discountAmount.toLocaleString() + '원';
            } else {
                document.getElementById('discount-row').style.display = 'none';
            }
            
            // 상품금액
            document.getElementById('summary-price').textContent = selectedPackage.price.toLocaleString() + '원';
            
            // 부가세 (10%)
            const vat = Math.round(selectedPackage.price * 0.1);
            document.getElementById('summary-vat').textContent = vat.toLocaleString() + '원';
            
            // 최종 결제금액
            const total = selectedPackage.price + vat;
            document.getElementById('summary-total').textContent = total.toLocaleString() + '원';
        }
        
        // 결제 수단 선택
        const paymentMethods = document.querySelectorAll('.payment-method');
        paymentMethods.forEach(method => {
            method.addEventListener('click', () => {
                paymentMethods.forEach(m => m.classList.remove('selected'));
                method.classList.add('selected');
            });
        });
        
        // 연락처 자동 포맷팅
        const phoneInput = document.getElementById('phone');
        phoneInput.addEventListener('input', function(e) {
            // 숫자만 추출
            let value = e.target.value.replace(/[^0-9]/g, '');
            
            // 하이픈 자동 추가
            if (value.length <= 3) {
                e.target.value = value;
            } else if (value.length <= 7) {
                e.target.value = value.slice(0, 3) + '-' + value.slice(3);
            } else if (value.length <= 11) {
                e.target.value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
            }
        });
        
        // 연락처 유효성 검사
        phoneInput.addEventListener('blur', function(e) {
            const value = e.target.value.replace(/[^0-9]/g, '');
            
            // 빈 값이면 검사 건너뛰기 (필수 필드 검증은 별도로 처리)
            if (value === '') return;
            
            // 010으로 시작하는지 확인
            if (!value.startsWith('010')) {
                alert('연락처는 010으로 시작하는 휴대폰 번호를 입력해주세요.');
                // setTimeout으로 포커스를 지연시켜 alert 창이 닫힌 후 포커스 이동
                setTimeout(() => {
                    e.target.focus();
                    e.target.select();
                }, 100);
                return;
            }
            
            // 11자리 확인
            if (value.length !== 11) {
                alert('휴대폰 번호는 11자리여야 합니다.\n예: 010-1234-5678');
                // setTimeout으로 포커스를 지연시켜 alert 창이 닫힌 후 포커스 이동
                setTimeout(() => {
                    e.target.focus();
                    e.target.select();
                }, 100);
                return;
            }
        });
        
        // 이메일 유효성 검사
        const emailInput = document.getElementById('email');
        emailInput.addEventListener('blur', function(e) {
            const value = e.target.value.trim();
            
            if (value === '') return; // 빈 값이면 필수 검증에서 처리
            
            // 이메일 형식 정규표현식
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            
            if (!emailRegex.test(value)) {
                alert('올바른 이메일 형식이 아닙니다.\n예: example@email.com');
                // setTimeout으로 포커스를 지연시켜 alert 창이 닫힌 후 포커스 이동
                setTimeout(() => {
                    e.target.focus();
                    e.target.select();
                }, 100);
                return;
            }
        });
        
        // 사업자등록번호 자동 포맷팅 (매장명/사업자등록번호 필드 숨김 처리로 주석 처리)
        /*
        const businessNumberInput = document.getElementById('business-number');
        if (businessNumberInput) {
            businessNumberInput.addEventListener('input', function(e) {
                // 숫자만 추출
                let value = e.target.value.replace(/[^0-9]/g, '');
                
                // 하이픈 자동 추가 (000-00-00000 형식)
                if (value.length <= 3) {
                    e.target.value = value;
                } else if (value.length <= 5) {
                    e.target.value = value.slice(0, 3) + '-' + value.slice(3);
                } else if (value.length <= 10) {
                    e.target.value = value.slice(0, 3) + '-' + value.slice(3, 5) + '-' + value.slice(5);
                }
            });
        }
        */
        
        // 전체 동의 체크박스
        const agreeAll = document.getElementById('agree-all');
        const agreeItems = document.querySelectorAll('.agree-item');
        
        agreeAll.addEventListener('change', () => {
            agreeItems.forEach(item => {
                item.checked = agreeAll.checked;
            });
        });
        
        agreeItems.forEach(item => {
            item.addEventListener('change', () => {
                const allChecked = Array.from(agreeItems).every(i => i.checked);
                agreeAll.checked = allChecked;
            });
        });
        
        // 결제 처리
        function processPayment() {
            // 패키지 선택 확인
            if (!selectedPackage) {
                alert('패키지를 선택해주세요.');
                // 패키지 선택 섹션으로 스크롤
                document.querySelector('.package-selection').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            // 필수 입력 필드 체크 (체크박스 제외)
            const requiredInputs = document.querySelectorAll('input[required]:not([type="checkbox"]), select[required], textarea[required]');
            let isValid = true;
            let firstInvalidInput = null;
            
            requiredInputs.forEach(input => {
                if (!input.value) {
                    isValid = false;
                    input.style.borderColor = 'var(--color-accent-hover)';
                    if (!firstInvalidInput) firstInvalidInput = input;
                } else {
                    input.style.borderColor = '';
                }
            });
            
            if (!isValid) {
                alert('필수 항목을 모두 입력해주세요.');
                if (firstInvalidInput) {
                    firstInvalidInput.focus();
                }
                return;
            }
            
            // 필수 약관 동의 체크
            const requiredCheckboxes = document.querySelectorAll('.agree-item[required]');
            let allAgreed = true;
            
            requiredCheckboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    allAgreed = false;
                }
            });
            
            if (!allAgreed) {
                alert('필수 약관에 모두 동의해주세요.');
                // 약관 동의 섹션으로 스크롤
                document.querySelector('.agreement-section').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            // 연락처 유효성 재확인
            const phoneValue = document.getElementById('phone').value.replace(/[^0-9]/g, '');
            if (!phoneValue.startsWith('010')) {
                alert('연락처는 010으로 시작하는 휴대폰 번호를 입력해주세요.');
                setTimeout(() => {
                    document.getElementById('phone').focus();
                    document.getElementById('phone').select();
                }, 100);
                return;
            }
            if (phoneValue.length !== 11) {
                alert('휴대폰 번호는 11자리여야 합니다.\n예: 010-1234-5678');
                setTimeout(() => {
                    document.getElementById('phone').focus();
                    document.getElementById('phone').select();
                }, 100);
                return;
            }
            
            // 이메일 유효성 재확인
            const emailValue = document.getElementById('email').value.trim();
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!emailRegex.test(emailValue)) {
                alert('올바른 이메일 형식이 아닙니다.\n예: example@email.com');
                setTimeout(() => {
                    document.getElementById('email').focus();
                    document.getElementById('email').select();
                }, 100);
                return;
            }
            
            // 결제 수단 선택 확인
            const selectedPayment = document.querySelector('.payment-method.selected');
            if (!selectedPayment) {
                alert('결제 수단을 선택해주세요.');
                document.querySelector('.payment-methods').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            // 결제 정보 준비
            const paymentData = {
                package: {
                    name: '블로그 체험단',
                    people: selectedPackage.people,
                    originalPrice: selectedPackage.originalPrice,
                    discountRate: selectedPackage.discount,
                    price: selectedPackage.price,
                    vat: Math.round(selectedPackage.price * 0.1),
                    total: selectedPackage.price + Math.round(selectedPackage.price * 0.1)
                },
                customer: {
                    company: document.getElementById('store-name') ? document.getElementById('store-name').value : '', // 서비스 정보의 매장명
                    name: document.getElementById('name').value,
                    phone: document.getElementById('phone').value,
                    email: document.getElementById('email').value,
                    businessType: document.getElementById('business-type') ? document.getElementById('business-type').value : '' // 업종
                },
                paymentMethod: selectedPayment.querySelector('.payment-name').textContent
            };
            
            console.log('Payment Data:', paymentData);

            // 결제 정보를 로컬 스토리지에 저장 (payment-complete에서 사용)
            localStorage.setItem('checkoutData', JSON.stringify({
                name: paymentData.customer.name,
                email: paymentData.customer.email,
                phone: paymentData.customer.phone,
                businessName: paymentData.customer.company || '',
                businessType: paymentData.customer.businessType || '',
                packageName: paymentData.package.name,
                packagePrice: paymentData.package.total,
                packagePeople: paymentData.package.people,
                timestamp: new Date().toISOString()
            }));

            // 페이앱 결제 요청
            console.log('=== 결제 프로세스 시작 ===');
            console.log('페이앱 라이브러리 확인:', typeof PayApp);
            console.log('payAppReady:', window.payAppReady);
            console.log('CONFIG 확인:', CONFIG);
            
            // 결제 수단에 따른 openpaytype 설정
            let payType = 'card';
            if (paymentData.paymentMethod === '계좌이체') {
                payType = 'rbank';
            } else if (paymentData.paymentMethod === '카카오페이') {
                payType = 'kakaopay';
            } else if (paymentData.paymentMethod === '네이버페이') {
                payType = 'naverpay';  
            } else if (paymentData.paymentMethod === '토스페이') {
                payType = 'tosspay';
            }
            
            // PayApp SDK가 준비되었는지 확인
            if (window.payAppReady && typeof PayApp !== 'undefined') {
                console.log('✅ PayApp SDK 사용 가능');
                
                try {
                    // 파라미터 초기화
                    if (PayApp.clearParam) {
                        PayApp.clearParam();
                    }
                    
                    // 필수 파라미터 설정
                    PayApp.setParam('cmd', 'payrequest');  // 명령어 추가
                    PayApp.setParam('userid', CONFIG.userid);  // userid 명시적 설정
                    PayApp.setParam('linkkey', CONFIG.linkkey);  // linkkey 필수
                    PayApp.setParam('goodname', `미블 체험단 ${paymentData.package.people}명`);
                    PayApp.setParam('price', paymentData.package.total.toString());
                    PayApp.setParam('recvphone', paymentData.customer.phone.replace(/-/g, ''));
                    PayApp.setParam('email', paymentData.customer.email || '');
                    PayApp.setParam('buyer', paymentData.customer.name);
                    PayApp.setParam('buyerphone', paymentData.customer.phone);
                    PayApp.setParam('buyeremail', paymentData.customer.email);
                    PayApp.setParam('memo', `블로그 체험단 ${paymentData.package.people}명 패키지`);
                    PayApp.setParam('smsuse', 'n');  // SMS 사용 안함
                    PayApp.setParam('redirectpay', '1');  // 바로 결제창으로
                    PayApp.setParam('skip_cstpage', 'y');  // 고객 정보 입력 페이지 스킵
                    PayApp.setParam('openpaytype', payType);  // 결제 수단
                    PayApp.setParam('var1', paymentData.package.people.toString());
                    PayApp.setParam('var2', paymentData.package.discountRate.toString());
                    // returnurl 설정 - POST 처리를 위해 payment-redirect API로
                    if (window.location.hostname.includes('vercel.app')) {
                        // Vercel 환경 - payment-redirect API로 POST 처리
                        PayApp.setParam('returnurl', 'https://mamahome-five.vercel.app/api/payment-redirect');
                    } else if (window.location.hostname.includes('github.io')) {
                        // GitHub Pages 환경 - Vercel API로
                        PayApp.setParam('returnurl', 'https://mamahome-five.vercel.app/api/payment-redirect');
                    } else if (window.location.protocol === 'file:') {
                        // 로컬 테스트 환경
                        PayApp.setParam('returnurl', 'https://mamahome-five.vercel.app/api/payment-redirect');
                    } else {
                        // 기타 환경 - API로
                        PayApp.setParam('returnurl', 'https://mamahome-five.vercel.app/api/payment-redirect');
                    }
                    // feedbackurl 제거 - 에러 70080 방지 (페이앱이 접속할 수 없는 URL일 때)
                    // PayApp.setParam('feedbackurl', CONFIG.feedbackurl)
                    
                    console.log('PayApp 파라미터 설정 완료');
                    
                    // 결제창 호출
                    PayApp.call();
                    console.log('✅ PayApp.call() 호출 완료');
                    
                    // 로컬 테스트 환경에서 결제 완료 후 처리
                    if (window.location.protocol === 'file:') {
                        alert('결제가 완료되면 확인 버튼을 눌러주세요.\n결제 완료 페이지로 이동합니다.');
                        // 결제 완료 후 수동으로 완료 페이지로 이동
                        setTimeout(() => {
                            if (confirm('결제를 완료하셨나요?')) {
                                window.location.href = '../pages/payment-complete.html';
                            }
                        }, 3000);
                    }
                    
                } catch (error) {
                    console.error('❌ PayApp SDK 호출 오류:', error);
                    // SDK 오류 시 폼 전송으로 폴백
                    useFormFallback();
                }
            } else {
                // PayApp SDK가 로드되지 않은 경우
                console.log('⚠️ PayApp SDK가 준비되지 않음');
                
                // SDK 로드 재시도
                if (!window.payAppReady) {
                    console.log('SDK 로드 재시도 중...');
                    initPayApp();
                    
                    // 1초 후 다시 시도
                    setTimeout(() => {
                        if (window.payAppReady && typeof PayApp !== 'undefined') {
                            console.log('SDK 로드 성공! 결제 진행');
                            processPayment(); // 재귀 호출
                        } else {
                            console.log('SDK 로드 실패, 폼 전송 방식 사용');
                            useFormFallback();
                        }
                    }, 1000);
                } else {
                    useFormFallback();
                }
            }
            
            // 폼 전송 폴백 함수
            function useFormFallback() {
                console.log('📝 폼 전송 방식으로 결제 진행');
                
                // 커스텀 결제 모듈 사용
                if (window.PayappPayment) {
                    const paymentModule = new PayappPayment(CONFIG);
                    
                    paymentModule.requestPayment({
                        goodname: paymentData.customer.company || '미입력',
                        price: paymentData.package.total,
                        recvphone: paymentData.customer.phone,
                        buyer: paymentData.customer.name,
                        email: paymentData.customer.email,
                        memo: `블로그 체험단 ${paymentData.package.people}명 패키지`,
                        var1: paymentData.package.people,
                        var2: paymentData.package.discountRate,
                        paymentMethod: paymentData.paymentMethod
                    }, (result) => {
                        if (result.state === 'SUCCESS' || result.state === 'PROCESSING') {
                            console.log('결제 처리:', result.message);
                        } else if (result.state === 'ERROR') {
                            alert('결제 처리 실패: ' + result.message);
                        }
                    });
                } else {
                    // PayappPayment 모듈도 없는 경우 - 직접 폼 전송
                    console.log('직접 폼 전송 방식 사용');
                    
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = 'https://api.payapp.kr/oapi/apiLoad.html';
                    form.target = 'payapp_window';
                    form.style.display = 'none';
                    
                    // 파라미터 추가
                    const params = {
                        cmd: 'payrequest',
                        userid: CONFIG.userid,
                        linkkey: CONFIG.linkkey,
                        goodname: paymentData.customer.company || '미입력',
                        price: paymentData.package.total.toString(),
                        recvphone: paymentData.customer.phone.replace(/-/g, ''),
                        buyer: paymentData.customer.name,
                        email: paymentData.customer.email,
                        memo: `블로그 체험단 ${paymentData.package.people}명 패키지`,
                        smsuse: 'n',
                        redirectpay: '1',
                        skip_cstpage: 'y',
                        reqaddr: '0',
                        var1: paymentData.package.people.toString(),
                        var2: paymentData.package.discountRate.toString(),
                        // feedbackurl 제거 - 콜백 서버 없을 때 에러 70080 방지
                        returnurl: window.location.origin + '/pages/payment-complete.html'
                    };
                    
                    // 결제 수단별 openpaytype
                    if (paymentData.paymentMethod === '계좌이체') params.openpaytype = 'rbank';
                    else if (paymentData.paymentMethod === '카카오페이') params.openpaytype = 'kakaopay';
                    else if (paymentData.paymentMethod === '네이버페이') params.openpaytype = 'naverpay';
                    else if (paymentData.paymentMethod === '토스페이') params.openpaytype = 'tosspay';
                    else params.openpaytype = 'card';
                    
                    // 새창 열기
                    const payWindow = window.open('', 'payapp_window', 'width=720,height=800,scrollbars=yes,resizable=yes');
                    
                    if (payWindow) {
                        // input 필드 생성
                        for (const [key, value] of Object.entries(params)) {
                            const input = document.createElement('input');
                            input.type = 'hidden';
                            input.name = key;
                            input.value = value;
                            form.appendChild(input);
                        }
                        
                        // 폼 제출
                        document.body.appendChild(form);
                        form.submit();
                        
                        // 폼 제거
                        setTimeout(() => {
                            document.body.removeChild(form);
                        }, 100);
                        
                        console.log('✅ 결제창 열기 성공');
                    } else {
                        alert('팝업이 차단되었습니다. 팝업을 허용한 후 다시 시도해주세요.');
                    }
                }
            }
        }
        
        // URL 파라미터로 패키지 정보 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const packageId = urlParams.get('package');
        console.log('Selected package:', packageId);
        
        // 초기 패키지 선택 함수 (모든 초기화 후 실행)
        function initializeDefaultPackage() {
            console.log('=== 초기 패키지 선택 시작 ===');
            
            // 60명 패키지 요소 찾기
            const sixtyPackage = document.querySelector('.package-option[data-people="60"]');
            console.log('60명 패키지 요소:', sixtyPackage);
            
            if (!sixtyPackage) {
                console.error('60명 패키지를 찾을 수 없습니다');
                return;
            }
            
            // 모든 패키지에서 selected 클래스 제거
            const allPackages = document.querySelectorAll('.package-option');
            allPackages.forEach(pkg => {
                pkg.classList.remove('selected');
            });
            
            // 60명 패키지에 selected 클래스 추가
            sixtyPackage.classList.add('selected');
            console.log('60명 패키지에 selected 클래스 추가 완료');
            
            // 선택된 패키지 데이터 설정
            selectedPackage = {
                people: '60',
                originalPrice: 600000,
                price: 360000,
                discount: 40
            };
            console.log('selectedPackage 설정 완료:', selectedPackage);
            
            // 주문 요약 강제 업데이트
            const summaryEmpty = document.getElementById('summary-empty');
            const summaryContent = document.getElementById('summary-content');
            
            if (summaryEmpty && summaryContent) {
                summaryEmpty.style.display = 'none';
                summaryContent.style.display = 'block';
                
                // 각 항목 직접 업데이트
                document.getElementById('summary-people').textContent = '60명';
                document.getElementById('summary-original').textContent = '600,000원';
                document.getElementById('discount-row').style.display = 'flex';
                document.getElementById('discount-label').textContent = '할인 (40%)';
                document.getElementById('summary-discount').textContent = '-240,000원';
                document.getElementById('summary-price').textContent = '360,000원';
                document.getElementById('summary-vat').textContent = '36,000원';
                document.getElementById('summary-total').textContent = '396,000원';
                
                console.log('주문 요약 업데이트 완료');
            }
            
            console.log('=== 초기 패키지 선택 완료 ===');
        }
        
        // initializePage 함수 정의 (지연 없이 즉시 실행)
        function initializePage() {
            console.log('페이지 초기화 시작');
            // 지연 없이 바로 실행
            initializeDefaultPackage();

            // 로그인한 사용자 정보 자동 입력
            autoFillUserInfo();
        }

        // 로그인한 사용자 정보를 자동으로 채우는 함수
        async function autoFillUserInfo() {
            let userInfo = null;

            // 먼저 마이페이지에서 전달된 데이터 확인
            const checkoutUserData = localStorage.getItem('checkoutUserData');
            if (checkoutUserData) {
                try {
                    userInfo = JSON.parse(checkoutUserData);
                    console.log('마이페이지에서 전달된 사용자 정보:', userInfo);
                    // 사용 후 삭제 (보안상)
                    localStorage.removeItem('checkoutUserData');
                } catch (e) {
                    console.error('checkoutUserData 파싱 오류:', e);
                }
            }

            // checkoutUserData가 없으면 localStorage의 userInfo 직접 사용
            if (!userInfo) {
                // localStorage에서 userInfo 가져오기
                const storedUserInfo = localStorage.getItem('userInfo') || sessionStorage.getItem('userInfo');
                if (storedUserInfo) {
                    try {
                        userInfo = JSON.parse(storedUserInfo);
                        console.log('localStorage에서 가져온 사용자 정보:', userInfo);
                    } catch (e) {
                        console.error('userInfo 파싱 오류:', e);
                    }
                }
            }

            if (userInfo) {
                // JSON 문자열인 경우 파싱
                if (typeof userInfo === 'string') {
                    try {
                        userInfo = JSON.parse(userInfo);
                    } catch (e) {
                        console.error('사용자 정보 파싱 오류:', e);
                    }
                }

                // 이름 자동 입력
                if (userInfo.name) {
                    const nameInput = document.getElementById('name');
                    if (nameInput) {
                        nameInput.value = userInfo.name;
                        nameInput.style.borderColor = '';
                    }
                }

                // 이메일 자동 입력
                if (userInfo.email) {
                    const emailInput = document.getElementById('email');
                    if (emailInput) {
                        emailInput.value = userInfo.email;
                        emailInput.style.borderColor = '';
                    }
                }

                // 전화번호 자동 입력
                if (userInfo.phone) {
                    const phoneInput = document.getElementById('phone');
                    if (phoneInput) {
                        phoneInput.value = userInfo.phone;
                        phoneInput.style.borderColor = '';
                    }
                }

                // 업체명 자동 입력 (company 필드)
                if (userInfo.businessName || userInfo.business_name) {
                    const companyInput = document.getElementById('company');
                    if (companyInput) {
                        companyInput.value = userInfo.businessName || userInfo.business_name;
                        companyInput.style.borderColor = '';
                    }
                }

                // 사업자번호 자동 입력 (business-number 필드)
                if (userInfo.businessNumber || userInfo.business_number) {
                    const businessNumberInput = document.getElementById('business-number');
                    if (businessNumberInput) {
                        businessNumberInput.value = userInfo.businessNumber || userInfo.business_number;
                        businessNumberInput.style.borderColor = '';
                    }
                }

                console.log('✅ 사용자 정보 자동 입력 완료');
            }
        }

        // 사용자 데이터로 폼 채우기 헬퍼 함수
        function fillFormWithUserData(userInfo) {
            if (typeof userInfo === 'string') {
                try {
                    userInfo = JSON.parse(userInfo);
                } catch (e) {
                    console.error('사용자 정보 파싱 오류:', e);
                    return;
                }
            }

            // 이름 자동 입력
            if (userInfo.name) {
                const nameInput = document.getElementById('name');
                if (nameInput) nameInput.value = userInfo.name;
            }

            // 이메일 자동 입력
            if (userInfo.email) {
                const emailInput = document.getElementById('email');
                if (emailInput) emailInput.value = userInfo.email;
            }

            // 전화번호 자동 입력
            if (userInfo.phone) {
                const phoneInput = document.getElementById('phone');
                if (phoneInput) phoneInput.value = userInfo.phone;
            }

            // 업체명 자동 입력 (company 필드)
            if (userInfo.businessName || userInfo.business_name) {
                const companyInput = document.getElementById('company');
                if (companyInput) {
                    companyInput.value = userInfo.businessName || userInfo.business_name;
                }
            }

            // 사업자번호 자동 입력 (business-number 필드)
            if (userInfo.businessNumber || userInfo.business_number) {
                const businessNumberInput = document.getElementById('business-number');
                if (businessNumberInput) {
                    businessNumberInput.value = userInfo.businessNumber || userInfo.business_number;
                }
            }
        }
        
        // 입력 필드 실시간 유효성 검사
        document.querySelectorAll('input[required]').forEach(input => {
            if (input.type !== 'checkbox') {
                input.addEventListener('blur', () => {
                    if (input.value.trim()) {
                        input.style.borderColor = '';
                    } else {
                        input.style.borderColor = 'var(--color-accent-hover)';
                    }
                });
                
                input.addEventListener('input', () => {
                    if (input.value.trim()) {
                        input.style.borderColor = '';
                    }
                });
            }
        });
    </script>
</body>
</html>